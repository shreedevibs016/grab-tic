{% extends 'base.html' %}

{% block main %}

<main class="main">

  <!-- Movie Hero Section -->
  <section class="section" style="padding-top:120px; background-color:#0c0c0c; color:white; position:relative;">

    <!-- Background image -->
    <img src="/static/assets/img/hero-bg.jpg"
         style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; opacity:0.2;">

    <div class="container position-relative">

      <div class="row g-4 align-items-center">

        <!-- Poster -->
        <div class="col-md-4">
          <img src="{{ movie.photo.url }}"
               class="img-fluid rounded shadow"
               style="width:100%; max-width:350px; max-height: 350px; border-radius:10px;">
        </div>

        <!-- Movie Info -->
        <div class="col-md-8">

          <h1 class="fw-bold text-white" style="font-size:48px;">{{ movie.name }}</h1>

          <div class="d-flex align-items-center mt-3">
            <span class="badge bg-danger me-2" style="font-size:14px;">{{ movie.certification.name }}</span>
            <span style="font-size:16px;">{% for language in movie.languages.all %} <span class="me-2">{{ language.name }}</span> {% endfor %}</span>
          </div>

          <p class="mt-3 mb-1" style="font-size:18px;">
            <strong>Genre:</strong>{% for gen in movie.genre.all %} <span class="me-2">{{ gen.name }}</span> {% endfor %}
          </p>
          <p class="mb-1" style="font-size:18px;">
            {% show_runtime movie.runtime as runtime %}
            <strong>Duration:</strong> {{ runtime }}
          </p>
          <p class="mb-3" style="font-size:18px;">
            <strong>Releasing On:</strong> {{ movie.release_date |date:'d-m-Y' }}
          </p>

          <p id="desc" style="font-size:18px; max-width:650px;">
            {{ movie.description }}
          </p>
          {% check_permission request '["User"]' as allow %}

          {% if allow  %}
          <a href="{% if request.user.place %} {% url 'theatre-list' movie.uuid %}{% else %}{% url 'places' %}?next=movie-details&uuid={{ movie.uuid }}{% endif %}" class="btn btn-primary btn-lg mt-3"
                  style="background:#ff4a17; border:none; padding:12px 28px; border-radius:8px; font-size:20px;">
            <i class="bi bi-ticket-perforated"></i> Book Tickets
          </a>
          {% endif %}
        </div>

      </div>

    </div>

  </section>

  <!-- Cast Section -->
  <section class="section" style="background:#0f0f0f; color:white; padding:50px 0;">
    <div class="container">

      <h3 class="fw-bold text-white mb-4">Cast</h3>

      <div class="row g-4">

        <!-- Cast item -->
         {% for artist in movie.cast.all %}
        <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center">
          <img src="{{artist.photo.url}}"
               class="rounded-circle mb-2 shadow"
               style="width:120px; height:120px; object-fit:cover;">
          <p class="fw-semibold">{{ artist.name }}</p>
        </div>
        {% endfor %}

      </div>

    </div>
  </section>

</main>

<script> 
const div = document.getElementById("desc");
 const fullText = div.textContent.trim(); const limit = 150; 
 // characters to show initially 
 if (fullText.length > limit) { const shortText = fullText.slice(0, limit) + "  ..."; div.textContent = shortText;
 
 div.addEventListener("click", () => { if (div.textContent === shortText) { div.textContent = fullText; }
 
 else { div.textContent = shortText; } }); }
</script>

{% endblock %}
